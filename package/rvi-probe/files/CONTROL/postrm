#!/bin/sh
set -e
MARK_DIR="/etc/rvi-probe"; UHTTPD_MARK="$MARK_DIR/uhttpd_installed"; CF_MARK="$MARK_DIR/cloudflared_configured"
/etc/init.d/rvi-probe stop >/dev/null 2>&1 || true
/etc/init.d/rvi-probe disable >/dev/null 2>&1 || true
if [ -f "$UHTTPD_MARK" ]; then
  uci -q delete uhttpd.rvi 2>/dev/null || true
  uci -q commit uhttpd
  /etc/init.d/uhttpd reload >/dev/null 2>&1 || true
  rm -f "$UHTTPD_MARK"
fi
if [ -f "$CF_MARK" ]; then
  rm -f /etc/cloudflared/config.yml
  rm -f "$CF_MARK"
fi
rmdir "$MARK_DIR" 2>/dev/null || true
exit 0
