#!/bin/sh
set +e

PKG="rvi-probe"
VER="__VER__"
BASE="https://r2.rvinternethelp.com/openwrt/23.05"
INSTALL_URL="${BASE}/install-${PKG}-${VER}.sh"

# If opkg file list is empty, fetch + run the installer fallback
if ! opkg files $PKG 2>/dev/null | grep -q '/'; then
  echo "[${PKG}] opkg filelist empty; running installer fallback"
  if command -v uclient-fetch >/dev/null 2>&1; then
    uclient-fetch -qO- "$INSTALL_URL" | sh
  elif command -v wget >/dev/null 2>&1; then
    wget -qO- "$INSTALL_URL" | sh
  elif command -v curl >/dev/null 2>&1; then
    curl -fsSL "$INSTALL_URL" | sh
  else
    echo "[${PKG}] ERROR: no downloader available for fallback"
  fi
fi

exit 0
